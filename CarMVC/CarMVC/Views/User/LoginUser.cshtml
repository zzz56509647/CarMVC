@{
    ViewData["Title"] = "LoginUser";
}
<h1>百车汇租赁系统登录</h1>

<table class="table ">
    <tr>
        <td>用户姓名</td>
        <td>
            <input id="name" type="text" />
        </td>

    </tr>
    <tr>
        <td>用户密码:</td>
        <td>
            <input id="pass" type="password" />
        </td>
    </tr>
    <tr>
        <td>邮箱:</td>
        <td>
            <input id="mail" type="text" />
        </td>
    </tr>
    <tr>
        <td>验证码</td>
        <td>
            <input id="core" type="text" />
            <input id="Button1" type="button" value="获取验证码" onclick="CreateCore()" />

        </td>
    </tr>
    <tr>
        <td></td>
        <td>
            <input id="button" type="button" value="登录" @*onclick="Login()"*@ />
            <input id="Hidden1" type="hidden" />
        </td>
    </tr>

</table>


@section scripts{
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script src="~/Scripts/jquery-3.3.1.js"></script>
    <script type="text/javascript">

        ////发送验证码
        //function CreateCore() {
        //    var Email = $("#mail").val();
        //    $.ajax({
        //        url: 'http://localhost:57894/api/user/SendMailMessage?Email=' + Email,
        //        type: 'get',

        //        success: function (d) {
        //            alert(d);
        //            $("#Hidden1").val(d);
        //        }
        //    })
        //}
        //登录方法
        $("#button").click(function () {


            var obj = {};
            obj.Name = $("#name").val();
            obj.Pwd = $("#pass").val();

            if (obj.Name == "" || obj.Pwd == "") {
                alert("用户名或密码不能为空！");
                return;
            }

            //var core = $("#core").val();
            //var hidden = $("#Hidden1").val();
            //if (core != hidden) {
            //    alert("验证码错误！");
            //    return;
            //}


            $.ajax({
                url: 'http://localhost:57894/api/userlogin',
                type: 'post',
                //dataType: 'json',
                data: JSON.stringify(obj),
                contentType: "application/json",
                
                success: function (d) {
                    if (d > 0) {
                        alert("登录成功！");
                        location.href = '/Admin/OrderShow/';
                    }
                    else {
                        alert("用户名或密码错误！");
                        return;
                    }
                }
            })

            //else {
            //    alert("验证码错误！");
            //    location.href = '/User/LoginUser/';
            //}
        })

    </script>
}
