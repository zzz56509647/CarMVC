<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="stylesheet" type="text/css" href="css/component.css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="L:\实训一\百车汇汽车租赁系统mvc\CarMVC\CarMVC\css\demo.css" rel="stylesheet" />
    <link href="L:\实训一\百车汇汽车租赁系统mvc\CarMVC\CarMVC\css\normalize.css" rel="stylesheet" />
</head>
<body>
    <div class="container demo-1">
        <div class="content">
            <div id="large-header" class="large-header">
                <canvas id="demo-canvas"></canvas>
                <div class="logo_box">
                    <h3>百车汇-后台管理</h3>
                    <form action="#" name="f" method="post">
                        <div class="input_outer">
                            <span class="u_user"></span>
                            <input id="name" class="text" style="color: #FFFFFF !important" type="text" placeholder="请输入账户">
                        </div>
                        <div class="input_outer">
                            <span class="u_use"></span>
                            <input id="mail" class="text" style="color: #FFFFFF !important" type="text" placeholder="请输入邮箱">
                        </div>
                        <div class="input_outer">
                            <span class="us_uer"></span>
                            <input id="core" class="text" style="color: #FFFFFF !important; position:absolute; z-index:80;" placeholder="请输入验证码">
                        </div>
                        <div class="input_outer">
                            <input id="Button1" type="button" value="获取验证码" name="logpass" class="createcore" style="color: #FFFFFF !important; position:absolute; z-index:80;" onclick="createcore()">
                            <input id="Hidden1" type="hidden" />
                        </div>
                        <div class="mb2"><a class="act-but submit" href="javascript:;" style="color: #FFFFFF" onclick="AdminLogin()">登录</a></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
<script src="L:\实训一\百车汇汽车租赁系统mvc\CarMVC\CarMVC\js\demo-1.js"></script>

<script type="text/javascript">

    //发送验证码
    function createcore() {
        var Email = $("#email").val();
        var reg = /^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2, 4})$/;

        if (Email.search(reg) == -1) {
            alert("邮箱格式错误！");
            return;
        }
        $.ajax({
            url: 'http://localhost:57894/api/user/SendMailMessage?Email=' + Email,
            type: 'get',

            success: function (d) {
                alert(d);
                $("#Hidden1").val(d);
            }
        })
    }

    //登录方法
    function AdminLogin() {
        var obj = {};
        obj.Name = $("#name").val();
        obj.Email = $("#mail").val();

        if (obj.Name == "" || obj.Email == "") {
            alert("用户名或邮箱不能为空！");
            return;
        }

        var core = $("#core").val();
        var hidden = $("#Hidden1").val();
        if (core != hidden) {
            alert("验证码错误！");
            return;
        }


        $.ajax({
            url: 'http://localhost:57894/api/userlogin',
            type: 'post',
            //dataType: 'json',
            data: JSON.stringify(obj),
            contentType: "application/json",

            success: function (d) {
                if (d > 0) {
                    alert("登录成功！");
                    location.href = '/Admin/OrderShow/';
                }
                else {
                    alert("用户名或密码错误！");
                    return;
                }
            }
        })
    }

</script>